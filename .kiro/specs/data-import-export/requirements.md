# 数据导入导出功能 - 需求文档

## 介绍

为了保护玩家数据，提供完整的数据导入导出功能。管理员可以导出所有游戏数据为JSON文件，也可以从JSON文件导入数据恢复游戏状态。

## 词汇表

- **导出数据**: 将服务器上的所有游戏数据保存为JSON文件
- **导入数据**: 从JSON文件读取数据并覆盖服务器上的游戏数据
- **数据完整性**: 包含所有必要的游戏数据（郡国、势力、武将、军团等）

## 需求

### 需求 1: 导出数据API

**用户故事**: 作为管理员，我想导出所有游戏数据，以便备份和保护数据。

#### 接受标准

1. WHEN 管理员访问导出API THEN 系统SHALL返回包含所有游戏数据的JSON对象
2. WHEN 导出数据时 THEN 系统SHALL包含以下数据：
   - 游戏状态（年份、锁定状态、管理员代码）
   - 所有郡国数据
   - 所有势力数据（包含代码）
   - 所有军团数据
   - 所有武士数据
   - 所有特产配置
   - 初始数据
   - 操作记录
   - 记账日志
3. WHEN 导出数据时 THEN 系统SHALL添加导出时间戳和版本号
4. WHEN 导出数据时 THEN 系统SHALL返回可直接保存为JSON文件的格式

### 需求 2: 导入数据API

**用户故事**: 作为管理员，我想导入之前导出的数据，以便恢复游戏状态。

#### 接受标准

1. WHEN 管理员上传JSON文件进行导入 THEN 系统SHALL验证文件格式
2. WHEN 导入数据时 THEN 系统SHALL检查数据完整性和版本兼容性
3. WHEN 导入数据有效时 THEN 系统SHALL覆盖所有游戏数据
4. WHEN 导入数据无效时 THEN 系统SHALL返回详细的错误信息并不修改任何数据
5. WHEN 导入完成时 THEN 系统SHALL返回导入摘要（导入的数据数量）

### 需求 3: 管理员界面导入导出按钮

**用户故事**: 作为管理员，我想在管理界面上看到导入导出按钮，以便快速访问这些功能。

#### 接受标准

1. WHEN 管理员打开管理面板 THEN 系统SHALL显示"导出数据"按钮
2. WHEN 管理员点击"导出数据"按钮 THEN 系统SHALL下载包含所有数据的JSON文件
3. WHEN 管理员打开管理面板 THEN 系统SHALL显示"导入数据"按钮
4. WHEN 管理员点击"导入数据"按钮 THEN 系统SHALL打开文件选择对话框
5. WHEN 管理员选择JSON文件后 THEN 系统SHALL上传文件并导入数据
6. WHEN 导入成功时 THEN 系统SHALL显示成功提示和导入摘要
7. WHEN 导入失败时 THEN 系统SHALL显示错误信息

### 需求 4: 商业点数收入

**用户故事**: 作为玩家，我想商业点数能带来实际收益，以便激励我投资商业。

#### 接受标准

1. WHEN 计算年度收入时 THEN 系统SHALL添加商业点数收入 = 商业点数 × 200石
2. WHEN 显示收支明细时 THEN 系统SHALL单独显示"商业点数收入"这一项
3. WHEN 商业点数为0时 THEN 系统SHALL显示0石收入
4. WHEN 商业点数为50时 THEN 系统SHALL显示10000石收入

### 需求 5: 商业点数影响投资成功率

**用户故事**: 作为玩家，我想商业点数能提高投资成功率，以便鼓励长期投资。

#### 接受标准

1. WHEN 计算商业投资成功率时 THEN 系统SHALL添加商业点数加成 = 商业点数 ÷ 5 × 1%
2. WHEN 商业点数为0时 THEN 系统SHALL不添加加成
3. WHEN 商业点数为50时 THEN 系统SHALL添加10%加成
4. WHEN 最终成功率超过95%时 THEN 系统SHALL限制在95%
5. WHEN 最终成功率低于5%时 THEN 系统SHALL限制在5%

### 需求 6: 商业投资点数获得规则

**用户故事**: 作为玩家，我想清楚地了解如何获得商业点数。

#### 接受标准

1. WHEN 商业投资失败时 THEN 系统SHALL奖励2点商业点数
2. WHEN 商业投资成功且开发了特产时 THEN 系统SHALL奖励3点商业点数
3. WHEN 商业投资成功但没有特产可开发时 THEN 系统SHALL奖励8点商业点数
4. WHEN 商业投资大成功时 THEN 系统SHALL按照成功规则奖励点数（不额外加倍）
5. WHEN 商业点数达到100时 THEN 系统SHALL不再增加（上限100）
